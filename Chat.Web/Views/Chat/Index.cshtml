@{
    ViewBag.Title = "Welcome to SignalR based Chat!";
}
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="#">Sample Chat</a>
        </div>
    </div>
</nav>
<div class="container">
    <div id="error" class="alert alert-danger"></div>
    <div id="auth" class="form-inline">
        <label for="usr">Your nick name:</label>
        <input id="usr" type="text" class="form-control input-lg"/>
        <input id="join" type="button" value="Join" class="btn btn-primary"/>
    </div>
    <div id="chat">
        <div class="row">
            <div class="col-md-2">
                <ul id="users" class="list-group"></ul>
                <input id="leave" type="button" value="Leave" class="btn btn-primary"/>
            </div>
            <div class="col-md-10">
                <div id="messagesContainer" style="overflow-y: scroll; height: 400px; ">
                    <ul id="messages" class="list-group"></ul>
                </div>
                <div class="form-inline">
                    <label for="msg">Your message:</label>
                    <input id="msg" type="text" class="form-control input-lg" style="width: 80%"/>
                    <input id="broadcast" type="button" value="Send" class="btn btn-primary"/>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    function sendMessage(chatHub) {
        chatHub.server.sendMessage($('#msg').val());
        $('#msg').val('');
    }
    var userScrolled = false;
    var autoScrolling = true;
    $("#messagesContainer").on('scroll', function () {
        if (autoScrolling) {
            return;
        }

        if ($(this).scrollTop() + $(this).innerHeight() >= this.scrollHeight) {
            userScrolled = false;
        } else {
            userScrolled = true;
        }
    });

    $(function () {
       

        $("#error").hide();
        $("#auth").show();
        $("#chat").hide();
        var chatHub = $.connection.chatHub;
        chatHub.client.newMessage = function (username, message) {
            $('#messages').append('<li class="list-group-item"><span class="badge">' + username + '</span>' + message + '</li>');
            if (!userScrolled) {
                autoScrolling = true;

                $('#messagesContainer').animate({ scrollTop: $('#messagesContainer').prop("scrollHeight") }, 1000);
                autoScrolling = false;
            }
        };
        chatHub.client.invalidOperation = function(errorMessage) {
            $('#error').text(errorMessage).show().delay(3000).fadeOut();
        };
        chatHub.client.joinedSuccessfully = function (userList, recentMessages) {
            var i;
            for (i = 0; i < userList.length; i++) {
                var user = userList[i];
                $('#users').append('<li id="' + user + '" class="list-group-item">' + user + '</li>');
            }
            for (i = 0; i < recentMessages.length; i++) {
                var message = recentMessages[i];
                $('#messages').append('<li class="list-group-item"><span class="badge">' + message.UserName + '</span>' + message.Text + '</li>');
            }

            $('#auth').hide();
            $('#chat').show();
        }
        chatHub.client.leftSuccessfully = function() {
            $('#auth').show();
            $('#chat').hide();

        }
        chatHub.client.newUserJoined = function(username) {
            $('#users').append('<li id="' + username + '" class="list-group-item">' + username + '</li>');
            var userEntry = $('#' + username);
            userEntry.hide();
            userEntry.fadeIn();

        };
        chatHub.client.userleft = function(username) {
            var userEntry = $('#' + username);
            userEntry.fadeOut().delay(1000).queue(function(next) {
                userEntry.remove();
            });
        }

        $.connection.hub.start().done(function() {
            $('#msg').keyup(function(e) {
                if (e.keyCode === 13) {
                    sendMessage(chatHub);
                }
            });
            $('#join').click(function() {
                $('#messages').find('li').remove();
                $('#users').find('li').remove();
                chatHub.server.join($('#usr').val());
            });
            $('#leave').click(function() {
                chatHub.server.leave();
            });
            $("#broadcast").click(function() {
                sendMessage(chatHub);
            });
        });
    });
</script>